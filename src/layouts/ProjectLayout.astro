---
import BaseLayout from './BaseLayout.astro';
import TableOfContents from '../components/TableOfContents.astro';
import UpNext from '../components/UpNext.astro';

interface Props {
  frontmatter: {
    title: string;
    description: string;
    company: string;
    period: string;
    role: string;
    responsibilities?: string[];
    context?: string;
    myJob?: string;
    status?: string;
    thumbnail?: { src: string };
  };
  slug: string;
  nextProject?: {
    id: string;
    data: {
      title: string;
      tagline?: string;
      thumbnail?: any;
    };
  };
}

const { frontmatter, slug, nextProject } = Astro.props;
const isComingSoon = frontmatter.status === 'coming-soon';
const projectUrl = new URL(`/project/${slug}`, Astro.site);

const projectSchema = {
  "@context": "https://schema.org",
  "@type": "CreativeWork",
  "name": frontmatter.title,
  "description": frontmatter.description,
  "url": projectUrl.href,
  "creator": {
    "@type": "Person",
    "name": "Ivan Uruchurtu",
    "url": "https://ivan.cv"
  },
  "provider": {
    "@type": "Organization",
    "name": frontmatter.company
  },
  "dateCreated": frontmatter.period
};
---

<BaseLayout
  title={`${frontmatter.title} | Ivan Uruchurtu`}
  description={frontmatter.description}
  noindex={isComingSoon}
>
  <TableOfContents />
  <article class="py-8 md:py-12 relative max-w-4xl mx-auto">
    <header id="intro" class="mb-8 md:mb-12">
      <h1
        class="fade-stagger text-3xl sm:text-4xl md:text-5xl lg:text-7xl font-display font-light text-text-primary mb-4 leading-[1.2] md:leading-[1.15] text-center max-w-2xl mx-auto"
        data-stagger="1"
        style="font-variation-settings: 'opsz' 72, 'SOFT' 0, 'WONK' 1;"
      >
        {frontmatter.title}
      </h1>

      <div class="fade-stagger flex items-center justify-center gap-2 text-text-secondary text-sm mt-4" data-stagger="2">
        <span>{frontmatter.role}</span>
        <span>Â·</span>
        <span>{frontmatter.period}</span>
      </div>

      {frontmatter.context && (
        <p class="fade-stagger text-text-primary text-base leading-relaxed text-center max-w-2xl mx-auto mt-4 md:mt-6 text-balance" data-stagger="3">
          {frontmatter.context}
        </p>
      )}

      {frontmatter.thumbnail && (
        <img
          src={frontmatter.thumbnail.src}
          alt={frontmatter.title}
          class="fade-stagger w-full rounded-xl sm:rounded-2xl border border-white/10 mt-6 md:mt-10"
          data-stagger="4"
        />
      )}

    </header>

    <div class="fade-stagger prose prose-invert prose-sm max-w-none project-content" data-stagger="4">
      <slot />
    </div>

    <!-- Up Next -->
    {nextProject && (
      <section class="mt-20 md:mt-32 border-t border-white/[0.06] pt-10 md:pt-14">
        <UpNext
          title={nextProject.data.title}
          tagline={nextProject.data.tagline}
          thumbnail={nextProject.data.thumbnail}
          slug={nextProject.id}
        />
      </section>
    )}

    <!-- Project-specific structured data -->
    <script type="application/ld+json" set:html={JSON.stringify(projectSchema)} />
  </article>
</BaseLayout>

<style>
  .project-content :global(h2) {
    font-family: var(--font-sans);
    font-weight: 500;
    font-size: 0.75rem;
    line-height: 1;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--color-text-secondary);
    max-width: 42rem;
    margin-left: auto;
    margin-right: auto;
    margin-top: 3rem;
    margin-bottom: 0.75rem;
  }

  .project-content :global(img) {
    max-width: 100%;
    height: auto;
    border-radius: 0.75rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    cursor: zoom-in;
  }

  @media (min-width: 640px) {
    .project-content :global(img) {
      border-radius: 1rem;
    }
  }

  .project-content :global(img.medium-zoom-image--opened) {
    cursor: zoom-out !important;
  }

  .project-content :global(.image-grid img) {
    margin: 0;
  }

  .project-content :global(video) {
    width: 100%;
    border-radius: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .project-content :global(h3) {
    font-family: var(--font-display);
    font-weight: 300;
    font-size: 1.5rem;
    line-height: 1.25;
    color: var(--color-text-primary);
    margin-top: 0;
    margin-bottom: 1.5rem;
  }

  @media (min-width: 640px) {
    .project-content :global(h3) {
      font-size: 1.75rem;
      line-height: 1.2;
    }
  }

  @media (min-width: 768px) {
    .project-content :global(h3) {
      font-size: 2rem;
      line-height: 1.15;
    }
  }

  .project-content :global(.narrative p) {
    color: var(--color-text-primary);
    line-height: 1.7;
    margin-bottom: 1rem;
  }

  .project-content :global(blockquote) {
    border-left: 2px solid rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.02);
    padding: 0.75rem 1rem;
    border-radius: 0 6px 6px 0;
    max-width: 42rem;
    margin: 1.5rem 0;
  }

  .project-content :global(blockquote p) {
    color: var(--color-text-primary);
    font-size: 0.875rem;
    line-height: 1.6;
    margin: 0;
  }
</style>

